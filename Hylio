local Player = game:GetService("Players").LocalPlayer
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")

-- Создаем основной интерфейс
local MainGui = Instance.new("ScreenGui")
MainGui.Name = "PentagramUI"
MainGui.Parent = CoreGui

-- Главный контейнер для перемещения
local MainContainer = Instance.new("Frame")
MainContainer.Name = "MainContainer"
MainContainer.Size = UDim2.new(0, 50, 0, 50)
MainContainer.Position = UDim2.new(0, 20, 0.5, -25)
MainContainer.BackgroundTransparency = 1
MainContainer.Parent = MainGui

-- Главная кнопка с пентаграммой
local MainButton = Instance.new("TextButton")
MainButton.Name = "MainButton"
MainButton.Size = UDim2.new(1, 0, 1, 0)
MainButton.BackgroundColor3 = Color3.new(0, 0, 0)
MainButton.TextColor3 = Color3.new(1, 1, 0)
MainButton.Text = "★"
MainButton.Font = Enum.Font.SciFi
MainButton.TextSize = 30
MainButton.ZIndex = 10
MainButton.Parent = MainContainer

-- Окно меню
local MenuFrame = Instance.new("Frame")
MenuFrame.Name = "MenuFrame"
MenuFrame.Size = UDim2.new(0, 100, 0, 150)
MenuFrame.Position = UDim2.new(1, 5, 0, 0)
MenuFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
MenuFrame.Visible = false
MenuFrame.ZIndex = 9
MenuFrame.Parent = MainContainer

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = MenuFrame

-- Кнопки меню
local MenuButtons = {
    Menu = Instance.new("TextButton"),
    MM2 = Instance.new("TextButton"),
    TST = Instance.new("TextButton")
}

for name, button in pairs(MenuButtons) do
    button.Name = name
    button.Size = UDim2.new(0.9, 0, 0, 40)
    button.Position = UDim2.new(0.05, 0, 0, 0)
    button.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Text = name
    button.ZIndex = 10
    button.Parent = MenuFrame
end

-- Окно MM2
local MM2Frame = Instance.new("Frame")
MM2Frame.Name = "MM2Frame"
MM2Frame.Size = UDim2.new(0, 100, 0, 100)
MM2Frame.Position = UDim2.new(1, 105, 0, 0)
MM2Frame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
MM2Frame.Visible = false
MM2Frame.ZIndex = 9
MM2Frame.Parent = MainContainer

local MM2ListLayout = Instance.new("UIListLayout")
MM2ListLayout.Parent = MM2Frame

-- Кнопки MM2
local MM2Buttons = {
    Spam = Instance.new("TextButton"),
    Hab = Instance.new("TextButton")
}

for name, button in pairs(MM2Buttons) do
    button.Name = name
    button.Size = UDim2.new(0.9, 0, 0, 40)
    button.Position = UDim2.new(0.05, 0, 0, 0)
    button.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Text = name
    button.ZIndex = 10
    button.Parent = MM2Frame
end

-- Окно TST
local TSTFrame = Instance.new("Frame")
TSTFrame.Name = "TSTFrame"
TSTFrame.Size = UDim2.new(0, 100, 0, 100)
TSTFrame.Position = UDim2.new(1, 105, 0, 0)
TSTFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
TSTFrame.Visible = false
TSTFrame.ZIndex = 9
TSTFrame.Parent = MainContainer

local TSTListLayout = Instance.new("UIListLayout")
TSTListLayout.Parent = TSTFrame

-- Кнопки TST
local TSTButtons = {
    Shift = Instance.new("TextButton"),
    ShiftGUI = Instance.new("TextButton")
}

for name, button in pairs(TSTButtons) do
    button.Name = name
    button.Size = UDim2.new(0.9, 0, 0, 40)
    button.Position = UDim2.new(0.05, 0, 0, 0)
    button.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Text = name
    button.ZIndex = 10
    button.Parent = TSTFrame
end

-- Окно Menu (новое)
local MenuMenuFrame = Instance.new("Frame")
MenuMenuFrame.Name = "MenuMenuFrame"
MenuMenuFrame.Size = UDim2.new(0, 100, 0, 100)
MenuMenuFrame.Position = UDim2.new(1, 105, 0, 0)
MenuMenuFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
MenuMenuFrame.Visible = false
MenuMenuFrame.ZIndex = 9
MenuMenuFrame.Parent = MainContainer

local MenuMenuListLayout = Instance.new("UIListLayout")
MenuMenuListLayout.Parent = MenuMenuFrame

-- Кнопки Menu
local MenuMenuButtons = {
    Speed = Instance.new("TextButton"),
    Spin = Instance.new("TextButton")
}

for name, button in pairs(MenuMenuButtons) do
    button.Name = name
    button.Size = UDim2.new(0.9, 0, 0, 40)
    button.Position = UDim2.new(0.05, 0, 0, 0)
    button.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Text = name
    button.ZIndex = 10
    button.Parent = MenuMenuFrame
end

-- Логика перемещения при зажатии
local dragging = false
local dragStartPos
local containerStartPos

local function updatePosition(input)
    if dragging then
        local delta = input.Position - dragStartPos
        MainContainer.Position = UDim2.new(
            0, containerStartPos.X.Offset + delta.X,
            0, containerStartPos.Y.Offset + delta.Y
        )
    end
end

-- Обработка ввода
MainButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStartPos = input.Position
        containerStartPos = MainContainer.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainButton.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updatePosition(input)
    end
end)

-- Логика кнопок
MainButton.MouseButton1Click:Connect(function()
    if not dragging then
        MenuFrame.Visible = not MenuFrame.Visible
        MM2Frame.Visible = false
        TSTFrame.Visible = false
        MenuMenuFrame.Visible = false
    end
end)

MenuButtons.MM2.MouseButton1Click:Connect(function()
    MM2Frame.Visible = not MM2Frame.Visible
    MenuFrame.Visible = false
    TSTFrame.Visible = false
    MenuMenuFrame.Visible = false
end)

MenuButtons.TST.MouseButton1Click:Connect(function()
    TSTFrame.Visible = not TSTFrame.Visible
    MenuFrame.Visible = false
    MM2Frame.Visible = false
    MenuMenuFrame.Visible = false
end)

MenuButtons.Menu.MouseButton1Click:Connect(function()
    MenuMenuFrame.Visible = not MenuMenuFrame.Visible
    MenuFrame.Visible = false
    MM2Frame.Visible = false
    TSTFrame.Visible = false
end)

-- Функционал кнопки Spam (MM2)
MM2Buttons.Spam.MouseButton1Click:Connect(function()
    if not _G.SpamScriptActive then
        _G.SpamScriptActive = true
        MM2Buttons.Spam.Text = "Spam (ON)"
        MM2Buttons.Spam.BackgroundColor3 = Color3.new(0, 0.5, 0)
        
        local SpamControlGui = Instance.new("ScreenGui")
        SpamControlGui.Name = "SpamControlGui"
        SpamControlGui.Parent = CoreGui
        
        local ToggleButton = Instance.new("TextButton")
        ToggleButton.Size = UDim2.new(0, 100, 0, 50)
        ToggleButton.Position = UDim2.new(1, -110, 0, 10)
        ToggleButton.Text = "Toggle Spam"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        ToggleButton.Parent = SpamControlGui
        
        local Spamming = false
        local Tool = nil
        
        local function SpamTool()
            while Spamming and _G.SpamScriptActive do
                if Tool and Tool.Parent == Player.Character then
                    Tool.Parent = Player.Backpack
                    task.wait(0.1)
                elseif Tool then
                    Tool.Parent = Player.Character
                    task.wait(0.1)
                else
                    Spamming = false
                    ToggleButton.Text = "Toggle Spam"
                    break
                end
            end
        end
        
        ToggleButton.MouseButton1Click:Connect(function()
            if not Spamming then
                Tool = Player.Character:FindFirstChildOfClass("Tool") or Player.Backpack:FindFirstChildOfClass("Tool")
                
                if Tool then
                    Spamming = true
                    ToggleButton.Text = "Spamming..."
                    task.spawn(SpamTool)
                else
                    ToggleButton.Text = "No Tool Found"
                    task.wait(1)
                    ToggleButton.Text = "Toggle Spam"
                end
            else
                Spamming = false
                ToggleButton.Text = "Toggle Spam"
            end
        end)
        
        _G.SpamControlGui = SpamControlGui
    else
        _G.SpamScriptActive = false
        MM2Buttons.Spam.Text = "Spam"
        MM2Buttons.Spam.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        if _G.SpamControlGui then
            _G.SpamControlGui:Destroy()
            _G.SpamControlGui = nil
        end
    end
end)

-- Функционал кнопки Hab (MM2)
MM2Buttons.Hab.MouseButton1Click:Connect(function()
    if not _G.HabScriptActive then
        _G.HabScriptActive = true
        MM2Buttons.Hab.Text = "Hab (ON)"
        MM2Buttons.Hab.BackgroundColor3 = Color3.new(0, 0.5, 0)
        
        local function ghostMode()
            for _, part in ipairs(workspace:GetDescendants()) do
                if part:IsA("BasePart") and part.Transparency == 1 then
                    part.Transparency = 0.8
                end
            end
        end
        
        local function loadXhub()
            local success, err = pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/Au0yX/Community/main/XhubMM2"))()
            end)
            
            if not success then
                warn("Не удалось загрузить XhubMM2: " .. err)
            end
        end
        
        ghostMode()
        
        _G.HabConnection = workspace.DescendantAdded:Connect(function(part)
            if part:IsA("BasePart") and part.Transparency == 1 then
                part.Transparency = 0.8
            end
        end)
        
        loadXhub()
    else
        _G.HabScriptActive = false
        MM2Buttons.Hab.Text = "Hab"
        MM2Buttons.Hab.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        
        if _G.HabConnection then
            _G.HabConnection:Disconnect()
            _G.HabConnection = nil
        end
        
        for _, part in ipairs(workspace:GetDescendants()) do
            if part:IsA("BasePart") and part.Transparency == 0.8 then
                part.Transparency = 1
            end
        end
    end
end)

-- Функционал кнопки Shift (TST)
TSTButtons.Shift.MouseButton1Click:Connect(function()
    if not _G.ShiftEnabled then
        _G.ShiftEnabled = true
        TSTButtons.Shift.Text = "Shift (ON)"
        TSTButtons.Shift.BackgroundColor3 = Color3.new(0, 0.5, 0)
        
        local success, err = pcall(function()
            loadstring(game:HttpGet('https://pastebin.com/raw/CjNsnSDy'))()
        end)
        
        if not success then
            warn("Ошибка загрузки Shift: "..err)
            _G.ShiftEnabled = false
            TSTButtons.Shift.Text = "Shift (ERROR)"
            task.wait(1)
            TSTButtons.Shift.Text = "Shift"
            TSTButtons.Shift.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        end
    else
        _G.ShiftEnabled = false
        TSTButtons.Shift.Text = "Shift"
        TSTButtons.Shift.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    end
end)

-- Функционал кнопки ShiftGUI (TST)
TSTButtons.ShiftGUI.MouseButton1Click:Connect(function()
    if not _G.ShiftGUIEnabled then
        _G.ShiftGUIEnabled = true
        TSTButtons.ShiftGUI.Text = "ShiftGUI (ON)"
        TSTButtons.ShiftGUI.BackgroundColor3 = Color3.new(0, 0.5, 0)
        
        local success, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/1111113f/Shift-end-delete/refs/heads/main/Short"))()
        end)
        
        if not success then
            warn("Ошибка загрузки ShiftGUI: "..err)
            _G.ShiftGUIEnabled = false
            TSTButtons.ShiftGUI.Text = "ShiftGUI (ERROR)"
            task.wait(1)
            TSTButtons.ShiftGUI.Text = "ShiftGUI"
            TSTButtons.ShiftGUI.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        end
    else
        _G.ShiftGUIEnabled = false
        TSTButtons.ShiftGUI.Text = "ShiftGUI"
        TSTButtons.ShiftGUI.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    end
end)

-- Функционал кнопки Speed (Menu)
MenuMenuButtons.Speed.MouseButton1Click:Connect(function()
    if not _G.SpeedEnabled then
        _G.SpeedEnabled = true
        MenuMenuButtons.Speed.Text = "Speed (ON)"
        MenuMenuButtons.Speed.BackgroundColor3 = Color3.new(0, 0.5, 0)
        
        local success, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/1111113f/Test1/0c6b2528c2a0ad9fb435ce75d612b6210aa80bd6/Test1.1"))()
        end)
        
        if not success then
            warn("Ошибка загрузки Speed: "..err)
            _G.SpeedEnabled = false
            MenuMenuButtons.Speed.Text = "Speed (ERROR)"
            task.wait(1)
            MenuMenuButtons.Speed.Text = "Speed"
            MenuMenuButtons.Speed.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        end
    else
        _G.SpeedEnabled = false
        MenuMenuButtons.Speed.Text = "Speed"
        MenuMenuButtons.Speed.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    end
end)

-- Функционал кнопки Spin (Menu)
MenuMenuButtons.Spin.MouseButton1Click:Connect(function()
    if not _G.SpinEnabled then
        _G.SpinEnabled = true
        MenuMenuButtons.Spin.Text = "Spin (ON)"
        MenuMenuButtons.Spin.BackgroundColor3 = Color3.new(0, 0.5, 0)
        
        -- Создаем GUI для управления
        _G.SpinGUI = Instance.new("ScreenGui")
        _G.SpinGUI.Name = "SpinControlGUI"
        _G.SpinGUI.Parent = CoreGui
        
        -- Кнопка открытия
        local openBtn = Instance.new("TextButton")
        openBtn.Name = "OpenButton"
        openBtn.Size = UDim2.new(0, 50, 0, 50)
        openBtn.Position = UDim2.new(1, -60, 0, 20)
        openBtn.Text = "✓"
        openBtn.Font = Enum.Font.SourceSansBold
        openBtn.TextSize = 30
        openBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
        openBtn.TextColor3 = Color3.new(1, 1, 1)
        openBtn.Parent = _G.SpinGUI
        
        -- Панель управления
        local controlFrame = Instance.new("Frame")
        controlFrame.Name = "ControlFrame"
        controlFrame.Size = UDim2.new(0, 250, 0, 180)
        controlFrame.Position = UDim2.new(1, -270, 0, 20)
        controlFrame.BackgroundTransparency = 0.2
        controlFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        controlFrame.Visible = false
        controlFrame.Parent = _G.SpinGUI
        
        -- Кнопка закрытия
        local closeBtn = Instance.new("TextButton")
        closeBtn.Name = "CloseButton"
        closeBtn.Size = UDim2.new(0, 40, 0, 40)
        closeBtn.Position = UDim2.new(1, -50, 0, 0)
        closeBtn.Text = "×"
        closeBtn.Font = Enum.Font.SourceSansBold
        closeBtn.TextSize = 30
        closeBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
        closeBtn.TextColor3 = Color3.new(1, 1, 1)
        closeBtn.Parent = controlFrame
        
        -- Поле скорости
        local speedBox = Instance.new("TextBox")
        speedBox.Name = "SpeedBox"
        speedBox.Size = UDim2.new(0.8, 0, 0, 30)
        speedBox.Position = UDim2.new(0.1, 0, 0, 50)
        speedBox.Text = "100"
        speedBox.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
        speedBox.TextColor3 = Color3.new(1, 1, 1)
        speedBox.Parent = controlFrame
        
        -- Кнопка включения
        local toggleBtn = Instance.new("TextButton")
        toggleBtn.Name = "ToggleButton"
        toggleBtn.Size = UDim2.new(0.8, 0, 0, 50)
        toggleBtn.Position = UDim2.new(0.1, 0, 0, 100)
        toggleBtn.Text = "ВКЛЮЧИТЬ"
        toggleBtn.Font = Enum.Font.SourceSansBold
        toggleBtn.TextSize = 20
        toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
        toggleBtn.TextColor3 = Color3.new(1, 1, 1)
        toggleBtn.Parent = controlFrame
        
        -- Логика вращения
        local spinSpeed = 100
        local spinning = false
        local currentCharacter = Player.Character
        
        local function spinCharacter()
            if not currentCharacter then return end
            
            local humanoid = currentCharacter:FindFirstChild("Humanoid")
            local rootPart = currentCharacter:FindFirstChild("HumanoidRootPart")
            if not humanoid or not rootPart then return end
            
            local lastCFrame = rootPart.CFrame
            
            while spinning and currentCharacter and currentCharacter.Parent do
                if humanoid.MoveDirection.Magnitude > 0 then
                    local moveDir = humanoid.MoveDirection
                    lastCFrame = CFrame.new(rootPart.Position, rootPart.Position + moveDir) * CFrame.Angles(0, math.rad(spinSpeed), 0)
                    rootPart.CFrame = lastCFrame
                end
                task.wait()
            end
        end
        
        -- Обработчики событий
        openBtn.MouseButton1Click:Connect(function()
            controlFrame.Visible = true
            openBtn.Visible = false
            speedBox.Text = tostring(spinSpeed)
        end)
        
        closeBtn.MouseButton1Click:Connect(function()
            controlFrame.Visible = false
            openBtn.Visible = true
        end)
        
        speedBox.FocusLost:Connect(function()
            local newSpeed = tonumber(speedBox.Text)
            if newSpeed and newSpeed >= 0 and newSpeed <= 20000000 then
                spinSpeed = newSpeed
            else
                speedBox.Text = tostring(spinSpeed)
            end
        end)
        
        toggleBtn.MouseButton1Click:Connect(function()
            spinning = not spinning
            if spinning then
                toggleBtn.Text = "ВЫКЛЮЧИТЬ"
                toggleBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
                currentCharacter = Player.Character or Player.CharacterAdded:Wait()
                spinCharacter()
            else
                toggleBtn.Text = "ВКЛЮЧИТЬ"
                toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
            end
        end)
        
        -- Обработчик смены персонажа
        Player.CharacterAdded:Connect(function(character)
            currentCharacter = character
            
            if spinning then
                toggleBtn.Text = "ВЫКЛЮЧИТЬ"
                toggleBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
                
                character:WaitForChild("Humanoid")
                character:WaitForChild("HumanoidRootPart")
                spinCharacter()
            end
            
            character:WaitForChild("Humanoid").Died:Connect(function()
                -- Сохраняем состояние spinning
            end)
        end)
    else
        _G.SpinEnabled = false
        MenuMenuButtons.Spin.Text = "Spin"
        MenuMenuButtons.Spin.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        
        if _G.SpinGUI then
            _G.SpinGUI:Destroy()
            _G.SpinGUI = nil
        end
    end
end)
